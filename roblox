-- GORILLAHOOK - Universal Roblox Executor
-- Enhanced with keybind settings and improved logo
-- [[ KEY SYSTEM MED LIFETIME SAVE + KLOCKA ]]
local TweenService = game:GetService("TweenService")

local CorrectKey = "GORILLA-X7K9P2M4Q8N6R1Y5"
local KeySystemEnabled = true
local KEY_FILE = "GorillaHook_Key.txt"

-- Kolla om key redan Ã¤r sparad
local function isKeyValid()
    if isfile and isfile(KEY_FILE) then
        local savedKey = readfile(KEY_FILE)
        if savedKey == CorrectKey then
            return true
        end
    end
    return false
end

-- Spara key fÃ¶r alltid
local function saveKey()
    if writefile then
        writefile(KEY_FILE, CorrectKey)
    end
end

if KeySystemEnabled and not isKeyValid() then
    local keyEntered = false
    
    local KeyGui = Instance.new("ScreenGui")
    KeyGui.Name = "KeySystem"
    KeyGui.ResetOnSpawn = false
    KeyGui.Parent = game:GetService("CoreGui")
    
    local KeyFrame = Instance.new("Frame")
    KeyFrame.Size = UDim2.new(0, 500, 0, 320)
    KeyFrame.Position = UDim2.new(0.5, -250, 0.5, -160)
    KeyFrame.BackgroundColor3 = Color3.fromRGB(11, 13, 17)
    KeyFrame.BorderSizePixel = 0
    KeyFrame.Parent = KeyGui
    
    local UICorner = Instance.new("UICorner")
    UICorner.CornerRadius = UDim.new(0, 12)
    UICorner.Parent = KeyFrame
    
    local UIStroke = Instance.new("UIStroke")
    UIStroke.Color = Color3.fromRGB(67, 110, 251)
    UIStroke.Thickness = 2
    UIStroke.Transparency = 0.3
    UIStroke.Parent = KeyFrame
    
    TweenService:Create(UIStroke, TweenInfo.new(2, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut, -1, true), {Transparency = 0}):Play()
    
    local LogoImage = Instance.new("ImageLabel")
    LogoImage.Size = UDim2.new(0, 70, 0, 70)
    LogoImage.Position = UDim2.new(0.5, -35, 0, 20)
    LogoImage.BackgroundTransparency = 1
    LogoImage.Image = "rbxassetid://75405736411504"
    LogoImage.Parent = KeyFrame
    
    local Title = Instance.new("TextLabel")
    Title.Size = UDim2.new(1, 0, 0, 40)
    Title.Position = UDim2.new(0, 0, 0, 95)
    Title.BackgroundTransparency = 1
    Title.Text = "GORILLAHOOK"
    Title.Font = Enum.Font.GothamBold
    Title.TextSize = 24
    Title.TextColor3 = Color3.fromRGB(67, 110, 251)
    Title.Parent = KeyFrame
    
    local TitleStroke = Instance.new("UIStroke")
    TitleStroke.Color = Color3.fromRGB(67, 110, 251)
    TitleStroke.Thickness = 1
    TitleStroke.Transparency = 0.5
    TitleStroke.Parent = Title
    
    local Subtitle = Instance.new("TextLabel")
    Subtitle.Size = UDim2.new(1, 0, 0, 20)
    Subtitle.Position = UDim2.new(0, 0, 0, 135)
    Subtitle.BackgroundTransparency = 1
    Subtitle.Text = "Premium Key Authentication"
    Subtitle.Font = Enum.Font.Gotham
    Subtitle.TextSize = 12
    Subtitle.TextColor3 = Color3.fromRGB(125, 133, 144)
    Subtitle.Parent = KeyFrame
    
    local KeyInput = Instance.new("TextBox")
    KeyInput.Size = UDim2.new(0, 400, 0, 45)
    KeyInput.Position = UDim2.new(0.5, -200, 0, 170)
    KeyInput.BackgroundColor3 = Color3.fromRGB(20, 22, 27)
    KeyInput.BorderSizePixel = 1
    KeyInput.BorderColor3 = Color3.fromRGB(67, 110, 251)
    KeyInput.Text = ""
    KeyInput.PlaceholderText = "Enter key..."
    KeyInput.Font = Enum.Font.Gotham
    KeyInput.TextSize = 13
    KeyInput.TextColor3 = Color3.fromRGB(255, 255, 255)
    KeyInput.PlaceholderColor3 = Color3.fromRGB(125, 133, 144)
    KeyInput.ClearTextOnFocus = false
    KeyInput.Parent = KeyFrame
    
    local InputCorner = Instance.new("UICorner")
    InputCorner.CornerRadius = UDim.new(0, 8)
    InputCorner.Parent = KeyInput
    
    local InputPadding = Instance.new("UIPadding")
    InputPadding.PaddingLeft = UDim.new(0, 15)
    InputPadding.Parent = KeyInput
    
    local SubmitBtn = Instance.new("TextButton")
    SubmitBtn.Size = UDim2.new(0, 180, 0, 45)
    SubmitBtn.Position = UDim2.new(0.5, -90, 0, 235)
    SubmitBtn.BackgroundColor3 = Color3.fromRGB(67, 110, 251)
    SubmitBtn.Text = "SUBMIT KEY"
    SubmitBtn.Font = Enum.Font.GothamBold
    SubmitBtn.TextSize = 14
    SubmitBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    SubmitBtn.AutoButtonColor = false
    SubmitBtn.Parent = KeyFrame
    
    local BtnCorner = Instance.new("UICorner")
    BtnCorner.CornerRadius = UDim.new(0, 8)
    BtnCorner.Parent = SubmitBtn
    
    SubmitBtn.MouseEnter:Connect(function()
        TweenService:Create(SubmitBtn, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(87, 130, 255)}):Play()
    end)
    
    SubmitBtn.MouseLeave:Connect(function()
        TweenService:Create(SubmitBtn, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(67, 110, 251)}):Play()
    end)
    
    local Status = Instance.new("TextLabel")
    Status.Size = UDim2.new(1, 0, 0, 20)
    Status.Position = UDim2.new(0, 0, 0, 290)
    Status.BackgroundTransparency = 1
    Status.Text = ""
    Status.Font = Enum.Font.Gotham
    Status.TextSize = 11
    Status.TextColor3 = Color3.fromRGB(255, 100, 100)
    Status.Parent = KeyFrame
    
    local DiscordLabel = Instance.new("TextLabel")
    DiscordLabel.Size = UDim2.new(1, 0, 0, 20)
    DiscordLabel.Position = UDim2.new(0, 0, 1, -25)
    DiscordLabel.BackgroundTransparency = 1
    DiscordLabel.Text = "Get key at: discord.gg/gorillahook"
    DiscordLabel.Font = Enum.Font.GothamBold
    DiscordLabel.TextSize = 11
    DiscordLabel.TextColor3 = Color3.fromRGB(67, 110, 251)
    DiscordLabel.Parent = KeyFrame
    
    local CopyBtn = Instance.new("TextButton")
    CopyBtn.Size = UDim2.new(0, 250, 0, 20)
    CopyBtn.Position = UDim2.new(0.5, -125, 1, -25)
    CopyBtn.BackgroundTransparency = 1
    CopyBtn.Text = ""
    CopyBtn.Parent = KeyFrame
    
    CopyBtn.MouseButton1Click:Connect(function()
        setclipboard("discord.gg/gorillahook")
        local oldText = DiscordLabel.Text
        DiscordLabel.Text = "âœ… Discord link copied!"
        wait(2)
        DiscordLabel.Text = oldText
    end)
    
    local function checkKey()
        local inputKey = KeyInput.Text:gsub("%s+", ""):upper()
        
        if inputKey == CorrectKey:upper() then
            Status.Text = "âœ… Correct Key! Saving for lifetime..."
            Status.TextColor3 = Color3.fromRGB(100, 255, 100)
            
            -- SPARA KEY FÃ–R ALLTID
            saveKey()
            
            TweenService:Create(KeyFrame, TweenInfo.new(0.5), {BackgroundTransparency = 1}):Play()
            
            for _, child in pairs(KeyFrame:GetChildren()) do
                if child:IsA("TextLabel") or child:IsA("TextBox") or child:IsA("TextButton") then
                    TweenService:Create(child, TweenInfo.new(0.5), {TextTransparency = 1}):Play()
                elseif child:IsA("ImageLabel") then
                    TweenService:Create(child, TweenInfo.new(0.5), {ImageTransparency = 1}):Play()
                end
                if child:IsA("UIStroke") then
                    TweenService:Create(child, TweenInfo.new(0.5), {Transparency = 1}):Play()
                end
            end
            
            wait(1)
            KeyGui:Destroy()
            keyEntered = true
        else
            Status.Text = "âŒ Invalid Key! Get it from Discord"
            Status.TextColor3 = Color3.fromRGB(255, 100, 100)
            KeyInput.Text = ""
            
            local originalPos = KeyFrame.Position
            for i = 1, 3 do
                KeyFrame.Position = originalPos + UDim2.new(0, 10, 0, 0)
                wait(0.05)
                KeyFrame.Position = originalPos - UDim2.new(0, 10, 0, 0)
                wait(0.05)
            end
            KeyFrame.Position = originalPos
        end
    end
    
    SubmitBtn.MouseButton1Click:Connect(checkKey)
    
    KeyInput.FocusLost:Connect(function(enterPressed)
        if enterPressed and KeyInput.Text ~= "" then
            checkKey()
        end
    end)
    
    KeyFrame.Size = UDim2.new(0, 0, 0, 0)
    KeyFrame.BackgroundTransparency = 1
    
    for _, child in pairs(KeyFrame:GetChildren()) do
        if child:IsA("TextLabel") or child:IsA("TextBox") or child:IsA("TextButton") then
            child.TextTransparency = 1
        elseif child:IsA("ImageLabel") then
            child.ImageTransparency = 1
        end
    end
    
    wait(0.2)
    TweenService:Create(KeyFrame, TweenInfo.new(0.5, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
        Size = UDim2.new(0, 500, 0, 320),
        BackgroundTransparency = 0
    }):Play()
    
    wait(0.3)
    
    for _, child in pairs(KeyFrame:GetChildren()) do
        if child:IsA("TextLabel") or child:IsA("TextBox") or child:IsA("TextButton") then
            TweenService:Create(child, TweenInfo.new(0.3), {TextTransparency = 0}):Play()
        elseif child:IsA("ImageLabel") then
            TweenService:Create(child, TweenInfo.new(0.3), {ImageTransparency = 0}):Play()
        end
    end
    
    repeat wait(0.1) until keyEntered
else
    print("âœ… Key already verified - Welcome back!")
end



-- [[ EFTER DETTA FORTSÃ„TTER DITT GORILLAHOOK SCRIPT ]]

local player = game.Players.LocalPlayer
local camera = workspace.CurrentCamera
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local Lighting = game:GetService("Lighting")
local HttpService = game:GetService("HttpService")

-- [[ PERSISTENT CONFIG SYSTEM ]]
local CONFIG_FOLDER = "GorillaHook"
local CONFIG_PATH = CONFIG_FOLDER .. "/configs/"

if not isfolder(CONFIG_FOLDER) then
    makefolder(CONFIG_FOLDER)
end
if not isfolder(CONFIG_PATH) then
    makefolder(CONFIG_PATH)
end

local ConfigSystem = {}

function ConfigSystem:Save(name, data)
    local success, err = pcall(function()
        local jsonData = HttpService:JSONEncode({
            data = data,
            date = os.date("%Y-%m-%d %H:%M:%S"),
            version = "1.1"
        })
        writefile(CONFIG_PATH .. name .. ".json", jsonData)
    end)
    
    if success then
        print("âœ… Config '" .. name .. "' saved successfully!")
        return true
    else
        warn("âŒ Failed to save config: " .. tostring(err))
        return false
    end
end

function ConfigSystem:Load(name)
    local success, result = pcall(function()
        if isfile(CONFIG_PATH .. name .. ".json") then
            local content = readfile(CONFIG_PATH .. name .. ".json")
            local decoded = HttpService:JSONDecode(content)
            return decoded.data
        end
        return nil
    end)
    
    if success then
        return result
    else
        warn("âŒ Failed to load config: " .. tostring(result))
        return nil
    end
end

function ConfigSystem:Delete(name)
    local success, err = pcall(function()
        if isfile(CONFIG_PATH .. name .. ".json") then
            delfile(CONFIG_PATH .. name .. ".json")
            return true
        end
        return false
    end)
    
    if success then
        print("ðŸ—‘ï¸ Config '" .. name .. "' deleted!")
        return true
    else
        warn("âŒ Failed to delete config: " .. tostring(err))
        return false
    end
end

function ConfigSystem:List()
    local configs = {}
    local success, result = pcall(function()
        if isfolder(CONFIG_PATH) then
            local files = listfiles(CONFIG_PATH)
            for _, file in ipairs(files) do
                if file:match("%.json$") then
                    local name = file:match("([^/\\]+)%.json$")
                    local content = readfile(file)
                    local decoded = HttpService:JSONDecode(content)
                    table.insert(configs, {
                        name = name,
                        date = decoded.date or "Unknown"
                    })
                end
            end
        end
    end)
    
    if not success then
        warn("âŒ Failed to list configs: " .. tostring(result))
    end
    
    return configs
end

function ConfigSystem:SaveLast(data)
    self:Save("_autosave", data)
end

function ConfigSystem:LoadLast()
    return self:Load("_autosave")
end

-- [[ STATE VARIABLES ]]
local state = {
    -- Aimbot
    aimbotEnabled = false,
    aimbotMode = "Hold Key",
    teamCheck = false,
    prediction = false,
    stickyAim = false,
    fovSize = 180,
    smoothness = 8,
    fovCircle = false,
    
    -- ESP
    boxESP = false,
    boxFill = false,
    skeleton = false,
    nameESP = false,
    distanceESP = false,
    healthESP = false,
    tracers = false,
    espThickness = 2,
    espColor = Color3.fromRGB(67, 110, 251),
    
    -- Movement
    speedEnabled = false,
    speedValue = 50,
    flyEnabled = false,
    flySpeed = 100,
    infiniteJump = false,
    
    -- Visuals
    removeFog = false,
    fullbright = false,
    skyboxEnabled = false,
    skyboxType = "Default",
    weatherEffect = "none",
    
    -- Misc
    antiAFK = false,
    
    -- Keybinds
    aimbotKey = "Q",
    speedKey = "X",
    flyKey = "F",
    uiKey = "Insert",
}

-- Try to load last config on startup
local lastConfig = ConfigSystem:LoadLast()
if lastConfig then
    for k, v in pairs(lastConfig) do
        if state[k] ~= nil then
            state[k] = v
        end
    end
    print("ðŸ“„ Loaded autosave config")
end

local originalLighting = {
    Brightness = Lighting.Brightness,
    ClockTime = Lighting.ClockTime,
    FogEnd = Lighting.FogEnd,
    GlobalShadows = Lighting.GlobalShadows,
    Ambient = Lighting.Ambient
}

-- Store original skybox
local originalSkybox = {
    SkyboxBk = nil,
    SkyboxDn = nil,
    SkyboxFt = nil,
    SkyboxLf = nil,
    SkyboxRt = nil,
    SkyboxUp = nil
}

-- Save original skybox textures
for _, child in pairs(Lighting:GetChildren()) do
    if child:IsA("Sky") then
        originalSkybox.SkyboxBk = child.SkyboxBk
        originalSkybox.SkyboxDn = child.SkyboxDn
        originalSkybox.SkyboxFt = child.SkyboxFt
        originalSkybox.SkyboxLf = child.SkyboxLf
        originalSkybox.SkyboxRt = child.SkyboxRt
        originalSkybox.SkyboxUp = child.SkyboxUp
        break
    end
end

-- Skybox presets
local skyboxPresets = {
    ["Default"] = originalSkybox,
    ["Night"] = {
        SkyboxBk = "rbxasset://textures/sky/sky512_bk.jpg",
        SkyboxDn = "rbxasset://textures/sky/sky512_dn.jpg",
        SkyboxFt = "rbxasset://textures/sky/sky512_ft.jpg",
        SkyboxLf = "rbxasset://textures/sky/sky512_lf.jpg",
        SkyboxRt = "rbxasset://textures/sky/sky512_rt.jpg",
        SkyboxUp = "rbxasset://textures/sky/sky512_up.jpg"
    },
    ["Space"] = {
        SkyboxBk = "rbxassetid://159454299",
        SkyboxDn = "rbxassetid://159454296",
        SkyboxFt = "rbxassetid://159454293",
        SkyboxLf = "rbxassetid://159454286",
        SkyboxRt = "rbxassetid://159454300",
        SkyboxUp = "rbxassetid://159454288"
    },
    ["Purple Nebula"] = {
        SkyboxBk = "rbxassetid://570557620",
        SkyboxDn = "rbxassetid://570557514",
        SkyboxFt = "rbxassetid://570557559",
        SkyboxLf = "rbxassetid://570557620",
        SkyboxRt = "rbxassetid://570557559",
        SkyboxUp = "rbxassetid://570557474"
    },
    ["Red Nebula"] = {
        SkyboxBk = "rbxassetid://5084575798",
        SkyboxDn = "rbxassetid://5084575916",
        SkyboxFt = "rbxassetid://5103949679",
        SkyboxLf = "rbxassetid://5103948542",
        SkyboxRt = "rbxassetid://5103948784",
        SkyboxUp = "rbxassetid://5084576400"
    },
    ["Vaporwave"] = {
        SkyboxBk = "rbxassetid://1417494030",
        SkyboxDn = "rbxassetid://1417494146",
        SkyboxFt = "rbxassetid://1417494253",
        SkyboxLf = "rbxassetid://1417494402",
        SkyboxRt = "rbxassetid://1417494499",
        SkyboxUp = "rbxassetid://1417494643"
    }
}

-- [[ UI CREATION ]]
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "GorillaHookUI"
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = game:GetService("CoreGui")

local WeatherContainer = Instance.new("Frame")
WeatherContainer.Name = "WeatherContainer"
WeatherContainer.Size = UDim2.new(1, 0, 1, 0)
WeatherContainer.BackgroundTransparency = 1
WeatherContainer.ClipsDescendants = true
WeatherContainer.ZIndex = 1
WeatherContainer.Parent = ScreenGui

local Window = Instance.new("Frame")
Window.Name = "Window"
Window.Size = UDim2.new(0, 850, 0, 580)
Window.Position = UDim2.new(0.5, -425, 0.5, -290)
Window.BackgroundColor3 = Color3.fromRGB(11, 13, 17)
Window.BorderSizePixel = 0
Window.BackgroundTransparency = 1
Window.ZIndex = 2
Window.Parent = ScreenGui

Window.AnchorPoint = Vector2.new(0.5, 0.5)
Window.Position = UDim2.new(0.5, 0, 0.5, 0)
Window.Size = UDim2.new(0, 0, 0, 0)

local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0, 12)
UICorner.Parent = Window

local UIStroke = Instance.new("UIStroke")
UIStroke.Color = Color3.fromRGB(67, 110, 251)
UIStroke.Thickness = 2
UIStroke.Transparency = 0.3
UIStroke.Parent = Window

local glowTween = TweenService:Create(UIStroke, TweenInfo.new(2, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut, -1, true), {
    Transparency = 0
})
glowTween:Play()

-- Sidebar
local Sidebar = Instance.new("Frame")
Sidebar.Name = "Sidebar"
Sidebar.Size = UDim2.new(0, 220, 1, 0)
Sidebar.BackgroundColor3 = Color3.fromRGB(8, 10, 13)
Sidebar.BorderSizePixel = 0
Sidebar.Parent = Window

local SidebarCorner = Instance.new("UICorner")
SidebarCorner.CornerRadius = UDim.new(0, 12)
SidebarCorner.Parent = Sidebar

local SidebarBorder = Instance.new("Frame")
SidebarBorder.Size = UDim2.new(0, 1, 1, 0)
SidebarBorder.Position = UDim2.new(1, 0, 0, 0)
SidebarBorder.BackgroundColor3 = Color3.fromRGB(28, 31, 38)
SidebarBorder.BorderSizePixel = 0
SidebarBorder.Parent = Sidebar

-- [[ NY LOGO SEKTION ]]
local GorillaImage = Instance.new("ImageLabel")
GorillaImage.Name = "GorillaImage"
GorillaImage.Parent = Sidebar
GorillaImage.BackgroundTransparency = 1
GorillaImage.Position = UDim2.new(0.5, -30, 0, 15)
GorillaImage.Size = UDim2.new(0, 60, 0, 60)
GorillaImage.Image = "rbxassetid://75405736411504"
GorillaImage.ZIndex = 10

local Logo = Instance.new("TextLabel")
Logo.Name = "Logo"
Logo.Parent = Sidebar
Logo.Size = UDim2.new(1, 0, 0, 30)
Logo.Position = UDim2.new(0, 0, 0, 75)
Logo.BackgroundTransparency = 1
Logo.Text = "GORILLAHOOK"
Logo.Font = Enum.Font.GothamBold
Logo.TextSize = 18
Logo.TextColor3 = Color3.fromRGB(67, 110, 251)
Logo.ZIndex = 10

local LogoStroke = Instance.new("UIStroke")
LogoStroke.Color = Color3.fromRGB(67, 110, 251)
LogoStroke.Thickness = 1
LogoStroke.Transparency = 0.5
LogoStroke.Parent = Logo

local Version = Instance.new("TextLabel")
Version.Name = "Version"
Version.Parent = Sidebar
Version.Size = UDim2.new(1, 0, 0, 20)
Version.Position = UDim2.new(0, 0, 0, 95)
Version.BackgroundTransparency = 1
Version.Text = "PRIVATE v1.1"
Version.Font = Enum.Font.Gotham
Version.TextSize = 10
Version.TextColor3 = Color3.fromRGB(125, 133, 144)
Version.ZIndex = 10

-- Content Area
local Content = Instance.new("ScrollingFrame")
Content.Name = "Content"
Content.Size = UDim2.new(1, -220, 1, 0)
Content.Position = UDim2.new(0, 220, 0, 0)
Content.BackgroundTransparency = 1
Content.BorderSizePixel = 0
Content.ScrollBarThickness = 4
Content.ScrollBarImageColor3 = Color3.fromRGB(67, 110, 251)
Content.CanvasSize = UDim2.new(0, 0, 0, 0)
Content.Parent = Window

local ContentLayout = Instance.new("UIPadding")
ContentLayout.PaddingTop = UDim.new(0, 35)
ContentLayout.PaddingLeft = UDim.new(0, 35)
ContentLayout.PaddingRight = UDim.new(0, 35)
ContentLayout.PaddingBottom = UDim.new(0, 35)
ContentLayout.Parent = Content

-- [[ SKYBOX SYSTEM ]]
local currentSky = nil

local function applySkybox(skyboxName)
    local preset = skyboxPresets[skyboxName]
    if not preset then return end
    
    -- Remove existing sky
    for _, child in pairs(Lighting:GetChildren()) do
        if child:IsA("Sky") then
            child:Destroy()
        end
    end
    
    -- Create new sky
    currentSky = Instance.new("Sky")
    currentSky.Name = "GorillaHookSky"
    currentSky.SkyboxBk = preset.SkyboxBk
    currentSky.SkyboxDn = preset.SkyboxDn
    currentSky.SkyboxFt = preset.SkyboxFt
    currentSky.SkyboxLf = preset.SkyboxLf
    currentSky.SkyboxRt = preset.SkyboxRt
    currentSky.SkyboxUp = preset.SkyboxUp
    currentSky.Parent = Lighting
    
    print("ðŸŒŒ Skybox set to: " .. skyboxName)
end

local function restoreSkybox()
    -- Remove custom sky
    for _, child in pairs(Lighting:GetChildren()) do
        if child:IsA("Sky") and child.Name == "GorillaHookSky" then
            child:Destroy()
        end
    end
    
    -- Restore original if it existed
    if originalSkybox.SkyboxBk then
        local sky = Instance.new("Sky")
        sky.SkyboxBk = originalSkybox.SkyboxBk
        sky.SkyboxDn = originalSkybox.SkyboxDn
        sky.SkyboxFt = originalSkybox.SkyboxFt
        sky.SkyboxLf = originalSkybox.SkyboxLf
        sky.SkyboxRt = originalSkybox.SkyboxRt
        sky.SkyboxUp = originalSkybox.SkyboxUp
        sky.Parent = Lighting
    end
    
    currentSky = nil
    print("ðŸŒ… Skybox restored to default")
end

-- [[ WEATHER SYSTEM ]]
local weatherParticles = {}

local function createSnowflake()
    local size = math.random(2, 5)
    local snowflake = Instance.new("Frame")
    snowflake.Size = UDim2.new(0, size, 0, size)
    snowflake.Position = UDim2.new(math.random(0, 100) / 100, 0, 0, -10)
    snowflake.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    snowflake.BackgroundTransparency = math.random(0, 30) / 100
    snowflake.BorderSizePixel = 0
    snowflake.ZIndex = 10
    snowflake.Parent = WeatherContainer
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(1, 0)
    corner.Parent = snowflake
    
    table.insert(weatherParticles, snowflake)
    
    local fallTime = math.random(2, 4)
    local sway = math.random(-20, 20)
    
    local tween = TweenService:Create(snowflake, TweenInfo.new(fallTime, Enum.EasingStyle.Linear), {
        Position = UDim2.new(snowflake.Position.X.Scale + sway/1000, 0, 1, 10)
    })
    tween:Play()
    
    tween.Completed:Connect(function()
        snowflake:Destroy()
        for i, p in ipairs(weatherParticles) do
            if p == snowflake then
                table.remove(weatherParticles, i)
                break
            end
        end
    end)
end

local weatherActive = false

local function updateWeather()
    if not weatherActive or not Window.Visible then return end
    
    if state.weatherEffect == "snow" then
        createSnowflake()
    end
end

local function clearWeather()
    weatherActive = false
    for _, particle in pairs(weatherParticles) do
        pcall(function() particle:Destroy() end)
    end
    weatherParticles = {}
end

spawn(function()
    while true do
        if weatherActive and Window.Visible then
            updateWeather()
            wait(0.08)
        else
            wait(0.5)
        end
    end
end)

-- [[ UI COMPONENTS ]]
local currentY = 0
local currentTab = nil
local listeningForKey = nil

local function getKeyName(key)
    if key == "Insert" then return "INSERT"
    elseif key == "LeftShift" then return "LSHIFT"
    elseif key == "RightShift" then return "RSHIFT"
    elseif key == "LeftControl" then return "LCTRL"
    elseif key == "RightControl" then return "RCTRL"
    elseif key == "MouseButton1" then return "LMB"
    elseif key == "MouseButton2" then return "RMB"
    elseif key == "MouseButton3" then return "MMB"
    elseif key and key:match("MouseButton") then return key:upper()
    else return key:upper() end
end

local function stringToMouseButton(str)
    if str == "MouseButton1" then return Enum.UserInputType.MouseButton1
    elseif str == "MouseButton2" then return Enum.UserInputType.MouseButton2
    elseif str == "MouseButton3" then return Enum.UserInputType.MouseButton3
    else return nil end
end

local function getInputType(input)
    if input.UserInputType == Enum.UserInputType.Keyboard then
        return input.KeyCode.Name
    elseif input.UserInputType == Enum.UserInputType.MouseButton1 then
        return "MouseButton1"
    elseif input.UserInputType == Enum.UserInputType.MouseButton2 then
        return "MouseButton2"
    elseif input.UserInputType == Enum.UserInputType.MouseButton3 then
        return "MouseButton3"
    elseif input.UserInputType.Name:match("MouseButton") then
        return input.UserInputType.Name
    end
    return nil
end

local function createCategory(text, yPos)
    local cat = Instance.new("TextLabel")
    cat.Size = UDim2.new(1, -50, 0, 20)
    cat.Position = UDim2.new(0, 25, 0, yPos)
    cat.BackgroundTransparency = 1
    cat.Text = text:upper()
    cat.Font = Enum.Font.GothamBold
    cat.TextSize = 10
    cat.TextColor3 = Color3.fromRGB(125, 133, 144)
    cat.TextXAlignment = Enum.TextXAlignment.Left
    cat.Parent = Sidebar
    return cat
end

local function createNavButton(text, icon, yPos, callback)
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(1, 0, 0, 40)
    btn.Position = UDim2.new(0, 0, 0, yPos)
    btn.BackgroundColor3 = Color3.fromRGB(8, 10, 13)
    btn.BorderSizePixel = 0
    btn.Text = ""
    btn.AutoButtonColor = false
    btn.Parent = Sidebar
    
    local border = Instance.new("Frame")
    border.Size = UDim2.new(0, 3, 1, 0)
    border.BackgroundColor3 = Color3.fromRGB(67, 110, 251)
    border.BorderSizePixel = 0
    border.Visible = false
    border.Parent = btn
    
    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(1, -50, 1, 0)
    label.Position = UDim2.new(0, 50, 0, 0)
    label.BackgroundTransparency = 1
    label.Text = text
    label.Font = Enum.Font.Gotham
    label.TextSize = 13
    label.TextColor3 = Color3.fromRGB(125, 133, 144)
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Parent = btn
    
    btn.MouseButton1Click:Connect(function()
        for _, child in pairs(Sidebar:GetChildren()) do
            if child:IsA("TextButton") then
                child.BackgroundTransparency = 1
                local b = child:FindFirstChild("Frame")
                if b then b.Visible = false end
                local l = child:FindFirstChildOfClass("TextLabel")
                if l then l.TextColor3 = Color3.fromRGB(125, 133, 144) end
            end
        end
        
        btn.BackgroundColor3 = Color3.fromRGB(67, 110, 251)
        btn.BackgroundTransparency = 0.9
        border.Visible = true
        label.TextColor3 = Color3.fromRGB(230, 237, 243)
        
        callback()
    end)
    
    btn.MouseEnter:Connect(function()
        if not border.Visible then
            label.TextColor3 = Color3.fromRGB(230, 237, 243)
        end
    end)
    
    btn.MouseLeave:Connect(function()
        if not border.Visible then
            label.TextColor3 = Color3.fromRGB(125, 133, 144)
        end
    end)
    
    return btn
end

local function clearContent()
    for _, child in pairs(Content:GetChildren()) do
        if not child:IsA("UIPadding") then
            child:Destroy()
        end
    end
    currentY = 0
end

local function updateContentSize()
    Content.CanvasSize = UDim2.new(0, 0, 0, currentY + 35)
end

local function createToggle(parent, text, stateKey, callback)
    local item = Instance.new("Frame")
    item.Size = UDim2.new(1, 0, 0, 35)
    item.Position = UDim2.new(0, 0, 0, currentY)
    item.BackgroundTransparency = 1
    item.Parent = parent
    
    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(1, -50, 1, 0)
    label.BackgroundTransparency = 1
    label.Text = text
    label.Font = Enum.Font.Gotham
    label.TextSize = 13
    label.TextColor3 = Color3.fromRGB(125, 133, 144)
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Parent = item
    
    local toggle = Instance.new("Frame")
    toggle.Size = UDim2.new(0, 34, 0, 18)
    toggle.Position = UDim2.new(1, -34, 0.5, -9)
    toggle.BackgroundColor3 = state[stateKey] and Color3.fromRGB(67, 110, 251) or Color3.fromRGB(28, 31, 38)
    toggle.BorderSizePixel = 0
    toggle.Parent = item
    
    local toggleCorner = Instance.new("UICorner")
    toggleCorner.CornerRadius = UDim.new(1, 0)
    toggleCorner.Parent = toggle
    
    local knob = Instance.new("Frame")
    knob.Size = UDim2.new(0, 14, 0, 14)
    knob.Position = state[stateKey] and UDim2.new(0, 18, 0, 2) or UDim2.new(0, 2, 0, 2)
    knob.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    knob.BorderSizePixel = 0
    knob.Parent = toggle
    
    local knobCorner = Instance.new("UICorner")
    knobCorner.CornerRadius = UDim.new(1, 0)
    knobCorner.Parent = knob
    
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(1, 0, 1, 0)
    btn.BackgroundTransparency = 1
    btn.Text = ""
    btn.Parent = item
    
    btn.MouseButton1Click:Connect(function()
        state[stateKey] = not state[stateKey]
        
        TweenService:Create(toggle, TweenInfo.new(0.2), {
            BackgroundColor3 = state[stateKey] and Color3.fromRGB(67, 110, 251) or Color3.fromRGB(28, 31, 38)
        }):Play()
        
        TweenService:Create(knob, TweenInfo.new(0.2), {
            Position = state[stateKey] and UDim2.new(0, 18, 0, 2) or UDim2.new(0, 2, 0, 2)
        }):Play()
        
        if callback then callback(state[stateKey]) end
        ConfigSystem:SaveLast(state)
    end)
    
    currentY = currentY + 35
    updateContentSize()
end

local function createSlider(parent, text, stateKey, min, max, callback)
    local item = Instance.new("Frame")
    item.Size = UDim2.new(1, 0, 0, 50)
    item.Position = UDim2.new(0, 0, 0, currentY)
    item.BackgroundTransparency = 1
    item.Parent = parent
    
    local topBar = Instance.new("Frame")
    topBar.Size = UDim2.new(1, 0, 0, 20)
    topBar.BackgroundTransparency = 1
    topBar.Parent = item
    
    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(0.7, 0, 1, 0)
    label.BackgroundTransparency = 1
    label.Text = text
    label.Font = Enum.Font.Gotham
    label.TextSize = 12
    label.TextColor3 = Color3.fromRGB(125, 133, 144)
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Parent = topBar
    
    local valueLabel = Instance.new("TextLabel")
    valueLabel.Size = UDim2.new(0.3, 0, 1, 0)
    valueLabel.Position = UDim2.new(0.7, 0, 0, 0)
    valueLabel.BackgroundTransparency = 1
    valueLabel.Text = tostring(state[stateKey])
    valueLabel.Font = Enum.Font.GothamBold
    valueLabel.TextSize = 12
    valueLabel.TextColor3 = Color3.fromRGB(67, 110, 251)
    valueLabel.TextXAlignment = Enum.TextXAlignment.Right
    valueLabel.Parent = topBar
    
    local sliderBack = Instance.new("Frame")
    sliderBack.Size = UDim2.new(1, 0, 0, 4)
    sliderBack.Position = UDim2.new(0, 0, 0, 30)
    sliderBack.BackgroundColor3 = Color3.fromRGB(28, 31, 38)
    sliderBack.BorderSizePixel = 0
    sliderBack.Parent = item
    
    local sliderCorner = Instance.new("UICorner")
    sliderCorner.CornerRadius = UDim.new(0, 2)
    sliderCorner.Parent = sliderBack
    
    local fill = Instance.new("Frame")
    fill.Size = UDim2.new((state[stateKey] - min) / (max - min), 0, 1, 0)
    fill.BackgroundColor3 = Color3.fromRGB(67, 110, 251)
    fill.BorderSizePixel = 0
    fill.Parent = sliderBack
    
    local fillCorner = Instance.new("UICorner")
    fillCorner.CornerRadius = UDim.new(0, 2)
    fillCorner.Parent = fill
    
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(1, 0, 0, 30)
    btn.Position = UDim2.new(0, 0, 0, 20)
    btn.BackgroundTransparency = 1
    btn.Text = ""
    btn.Parent = item
    
    local dragging = false
    
    local function update(input)
        local pos = (input.Position.X - sliderBack.AbsolutePosition.X) / sliderBack.AbsoluteSize.X
        pos = math.clamp(pos, 0, 1)
        local value = math.floor(min + (max - min) * pos)
        
        state[stateKey] = value
        fill.Size = UDim2.new(pos, 0, 1, 0)
        valueLabel.Text = tostring(value)
        if callback then callback(value) end
        ConfigSystem:SaveLast(state)
    end
    
    btn.MouseButton1Down:Connect(function() dragging = true end)
    
    UserInputService.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = false
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            update(input)
        end
    end)
    
    btn.MouseButton1Click:Connect(function()
        local mouseLocation = UserInputService:GetMouseLocation()
        update({Position = Vector3.new(mouseLocation.X, mouseLocation.Y, 0)})
    end)
    
    currentY = currentY + 50
    updateContentSize()
end

local function createKeybind(parent, text, stateKey)
    local item = Instance.new("Frame")
    item.Size = UDim2.new(1, 0, 0, 35)
    item.Position = UDim2.new(0, 0, 0, currentY)
    item.BackgroundTransparency = 1
    item.Parent = parent
    
    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(0.6, 0, 1, 0)
    label.BackgroundTransparency = 1
    label.Text = text
    label.Font = Enum.Font.Gotham
    label.TextSize = 13
    label.TextColor3 = Color3.fromRGB(125, 133, 144)
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Parent = item
    
    local keybindBtn = Instance.new("TextButton")
    keybindBtn.Size = UDim2.new(0, 100, 0, 25)
    keybindBtn.Position = UDim2.new(1, -100, 0, 5)
    keybindBtn.BackgroundColor3 = Color3.fromRGB(8, 10, 13)
    keybindBtn.BorderSizePixel = 1
    keybindBtn.BorderColor3 = Color3.fromRGB(28, 31, 38)
    keybindBtn.Text = getKeyName(state[stateKey])
    keybindBtn.Font = Enum.Font.GothamBold
    keybindBtn.TextSize = 12
    keybindBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    keybindBtn.AutoButtonColor = false
    keybindBtn.Parent = item
    
    local btnCorner = Instance.new("UICorner")
    btnCorner.CornerRadius = UDim.new(0, 6)
    btnCorner.Parent = keybindBtn
    
    keybindBtn.MouseButton1Click:Connect(function()
        keybindBtn.Text = "..."
        keybindBtn.BackgroundColor3 = Color3.fromRGB(67, 110, 251)
        listeningForKey = {stateKey = stateKey, button = keybindBtn}
    end)
    
    keybindBtn.MouseEnter:Connect(function()
        if not listeningForKey or listeningForKey.button ~= keybindBtn then
            keybindBtn.BackgroundColor3 = Color3.fromRGB(15, 17, 21)
        end
    end)
    
    keybindBtn.MouseLeave:Connect(function()
        if not listeningForKey or listeningForKey.button ~= keybindBtn then
            keybindBtn.BackgroundColor3 = Color3.fromRGB(8, 10, 13)
        end
    end)
    
    currentY = currentY + 35
    updateContentSize()
end

local function createDropdown(parent, text, options, stateKey, callback)
    local item = Instance.new("Frame")
    item.Size = UDim2.new(1, 0, 0, 35)
    item.Position = UDim2.new(0, 0, 0, currentY)
    item.BackgroundTransparency = 1
    item.Parent = parent
    
    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(0.5, 0, 1, 0)
    label.BackgroundTransparency = 1
    label.Text = text
    label.Font = Enum.Font.Gotham
    label.TextSize = 13
    label.TextColor3 = Color3.fromRGB(125, 133, 144)
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Parent = item
    
    local dropdown = Instance.new("TextButton")
    dropdown.Size = UDim2.new(0, 150, 0, 25)
    dropdown.Position = UDim2.new(1, -150, 0, 5)
    dropdown.BackgroundColor3 = Color3.fromRGB(8, 10, 13)
    dropdown.BorderSizePixel = 1
    dropdown.BorderColor3 = Color3.fromRGB(28, 31, 38)
    dropdown.Text = state[stateKey]
    dropdown.Font = Enum.Font.Gotham
    dropdown.TextSize = 12
    dropdown.TextColor3 = Color3.fromRGB(255, 255, 255)
    dropdown.AutoButtonColor = false
    dropdown.Parent = item
    
    local dropCorner = Instance.new("UICorner")
    dropCorner.CornerRadius = UDim.new(0, 6)
    dropCorner.Parent = dropdown
    
    local list = Instance.new("Frame")
    list.Size = UDim2.new(1, 0, 0, #options * 30)
    list.Position = UDim2.new(0, 0, 1, 5)
    list.BackgroundColor3 = Color3.fromRGB(8, 10, 13)
    list.BorderSizePixel = 1
    list.BorderColor3 = Color3.fromRGB(28, 31, 38)
    list.Visible = false
    list.ZIndex = 5
    list.Parent = dropdown
    
    local listCorner = Instance.new("UICorner")
    listCorner.CornerRadius = UDim.new(0, 6)
    listCorner.Parent = list
    
    for i, option in ipairs(options) do
        local optBtn = Instance.new("TextButton")
        optBtn.Size = UDim2.new(1, 0, 0, 30)
        optBtn.Position = UDim2.new(0, 0, 0, (i-1) * 30)
        optBtn.BackgroundTransparency = 1
        optBtn.Text = option
        optBtn.Font = Enum.Font.Gotham
        optBtn.TextSize = 12
        optBtn.TextColor3 = Color3.fromRGB(200, 200, 200)
        optBtn.AutoButtonColor = false
        optBtn.ZIndex = 6
        optBtn.Parent = list
        
        optBtn.MouseButton1Click:Connect(function()
            state[stateKey] = option
            dropdown.Text = option
            list.Visible = false
            if callback then callback(option) end
            ConfigSystem:SaveLast(state)
        end)
        
        optBtn.MouseEnter:Connect(function()
            optBtn.TextColor3 = Color3.fromRGB(67, 110, 251)
        end)
        
        optBtn.MouseLeave:Connect(function()
            optBtn.TextColor3 = Color3.fromRGB(200, 200, 200)
        end)
    end
    
    dropdown.MouseButton1Click:Connect(function()
        list.Visible = not list.Visible
    end)
    
    currentY = currentY + 35
    updateContentSize()
end

local function createSection(parent, title)
    local section = Instance.new("TextLabel")
    section.Size = UDim2.new(1, 0, 0, 30)
    section.Position = UDim2.new(0, 0, 0, currentY)
    section.BackgroundTransparency = 1
    section.Text = title
    section.Font = Enum.Font.GothamBold
    section.TextSize = 14
    section.TextColor3 = Color3.fromRGB(230, 237, 243)
    section.TextXAlignment = Enum.TextXAlignment.Left
    section.Parent = parent
    
    currentY = currentY + 35
    updateContentSize()
end

-- ESP System
local espObjects = {}
local function removeESP(plr)
    if espObjects[plr] then
        for _, obj in pairs(espObjects[plr]) do
            pcall(function() obj:Remove() end)
        end
        espObjects[plr] = nil
    end
end

local function createESP(plr)
    if plr == player or not plr.Character or not plr.Character:FindFirstChild("HumanoidRootPart") then return end
    
    removeESP(plr)
    espObjects[plr] = {}
    
    if state.boxESP then
        local box = Drawing.new("Square")
        box.Thickness = state.espThickness
        box.Color = state.espColor
        box.Filled = false
        box.Visible = true
        espObjects[plr].Box = box
        
        if state.boxFill then
            local fill = Drawing.new("Square")
            fill.Color = state.espColor
            fill.Filled = true
            fill.Transparency = 0.3
            fill.Visible = true
            espObjects[plr].Fill = fill
        end
    end
    
    if state.nameESP then
        local name = Drawing.new("Text")
        name.Text = plr.Name
        name.Size = 16
        name.Center = true
        name.Outline = true
        name.Color = Color3.fromRGB(255, 255, 255)
        name.Visible = true
        espObjects[plr].Name = name
    end
    
    if state.distanceESP then
        local dist = Drawing.new("Text")
        dist.Size = 14
        dist.Center = true
        dist.Outline = true
        dist.Color = Color3.fromRGB(200, 200, 200)
        dist.Visible = true
        espObjects[plr].Distance = dist
    end
    
    if state.tracers then
        local tracer = Drawing.new("Line")
        tracer.Thickness = state.espThickness
        tracer.Color = state.espColor
        tracer.Visible = true
        espObjects[plr].Tracer = tracer
    end
end

function refreshESP()
    for _, plr in pairs(game.Players:GetPlayers()) do
        removeESP(plr)
        if plr ~= player then createESP(plr) end
    end
end

-- [[ CONFIG TAB ]]
local selectedConfig = nil
local configListFrame = nil

local function refreshConfigList()
    if not configListFrame then return end
    
    for _, child in pairs(configListFrame:GetChildren()) do
        if not child:IsA("UIListLayout") then
            child:Destroy()
        end
    end
    
    local configs = ConfigSystem:List()
    for _, cfg in pairs(configs) do
        if cfg.name ~= "_autosave" then
            local item = Instance.new("TextButton")
            item.Size = UDim2.new(1, -16, 0, 40)
            item.BackgroundColor3 = Color3.fromRGB(11, 13, 17)
            item.BorderSizePixel = 1
            item.BorderColor3 = Color3.fromRGB(28, 31, 38)
            item.Text = ""
            item.AutoButtonColor = false
            item.Parent = configListFrame
            
            local corner = Instance.new("UICorner")
            corner.CornerRadius = UDim.new(0, 6)
            corner.Parent = item
            
            local nameLabel = Instance.new("TextLabel")
            nameLabel.Size = UDim2.new(1, -16, 0.6, 0)
            nameLabel.Position = UDim2.new(0, 12, 0, 4)
            nameLabel.BackgroundTransparency = 1
            nameLabel.Text = cfg.name
            nameLabel.Font = Enum.Font.Gotham
            nameLabel.TextSize = 13
            nameLabel.TextColor3 = Color3.fromRGB(230, 237, 243)
            nameLabel.TextXAlignment = Enum.TextXAlignment.Left
            nameLabel.Parent = item
            
            local dateLabel = Instance.new("TextLabel")
            dateLabel.Size = UDim2.new(1, -16, 0.4, 0)
            dateLabel.Position = UDim2.new(0, 12, 0.6, 0)
            dateLabel.BackgroundTransparency = 1
            dateLabel.Text = cfg.date
            dateLabel.Font = Enum.Font.Gotham
            dateLabel.TextSize = 10
            dateLabel.TextColor3 = Color3.fromRGB(125, 133, 144)
            dateLabel.TextXAlignment = Enum.TextXAlignment.Left
            dateLabel.Parent = item
            
            item.MouseButton1Click:Connect(function()
                for _, child in pairs(configListFrame:GetChildren()) do
                    if child:IsA("TextButton") then
                        child.BackgroundColor3 = Color3.fromRGB(11, 13, 17)
                        child.BorderColor3 = Color3.fromRGB(28, 31, 38)
                    end
                end
                item.BackgroundColor3 = Color3.fromRGB(67, 110, 251)
                item.BackgroundTransparency = 0.9
                item.BorderColor3 = Color3.fromRGB(67, 110, 251)
                selectedConfig = cfg.name
            end)
            
            item.MouseEnter:Connect(function()
                if selectedConfig ~= cfg.name then
                    item.BackgroundColor3 = Color3.fromRGB(15, 17, 21)
                end
            end)
            
            item.MouseLeave:Connect(function()
                if selectedConfig ~= cfg.name then
                    item.BackgroundColor3 = Color3.fromRGB(11, 13, 17)
                end
            end)
        end
    end
end

local function saveCurrentConfig(name)
    local configData = {}
    for k, v in pairs(state) do
        if type(v) ~= "userdata" then
            configData[k] = v
        end
    end
    ConfigSystem:Save(name, configData)
    refreshConfigList()
end

local function loadConfig(name)
    local data = ConfigSystem:Load(name)
    if data then
        for k, v in pairs(data) do
            if state[k] ~= nil and type(v) ~= "userdata" then
                state[k] = v
            end
        end
        refreshESP()
        print("âœ… Config '" .. name .. "' loaded!")
    end
end

local function showConfigTab()
    clearContent()
    
    createSection(Content, "Config Manager")
    
    local infoFrame = Instance.new("Frame")
    infoFrame.Size = UDim2.new(1, 0, 0, 25)
    infoFrame.Position = UDim2.new(0, 0, 0, currentY)
    infoFrame.BackgroundTransparency = 1
    infoFrame.Parent = Content
    
    local infoLabel = Instance.new("TextLabel")
    infoLabel.Size = UDim2.new(1, 0, 1, 0)
    infoLabel.BackgroundTransparency = 1
    infoLabel.Text = " Here you can make configs:)"
    infoLabel.Font = Enum.Font.Gotham
    infoLabel.TextSize = 11
    infoLabel.TextColor3 = Color3.fromRGB(67, 110, 251)
    infoLabel.TextXAlignment = Enum.TextXAlignment.Left
    infoLabel.Parent = infoFrame
    
    currentY = currentY + 35
    
    local inputFrame = Instance.new("Frame")
    inputFrame.Size = UDim2.new(1, 0, 0, 35)
    inputFrame.Position = UDim2.new(0, 0, 0, currentY)
    inputFrame.BackgroundTransparency = 1
    inputFrame.Parent = Content
    
    local inputBox = Instance.new("TextBox")
    inputBox.Size = UDim2.new(1, -110, 0, 30)
    inputBox.BackgroundColor3 = Color3.fromRGB(8, 10, 13)
    inputBox.BorderSizePixel = 1
    inputBox.BorderColor3 = Color3.fromRGB(28, 31, 38)
    inputBox.PlaceholderText = "New config name..."
    inputBox.PlaceholderColor3 = Color3.fromRGB(125, 133, 144)
    inputBox.Text = ""
    inputBox.Font = Enum.Font.Gotham
    inputBox.TextSize = 12
    inputBox.TextColor3 = Color3.fromRGB(255, 255, 255)
    inputBox.TextXAlignment = Enum.TextXAlignment.Left
    inputBox.ClearTextOnFocus = false
    inputBox.Parent = inputFrame
    
    local inputCorner = Instance.new("UICorner")
    inputCorner.CornerRadius = UDim.new(0, 6)
    inputCorner.Parent = inputBox
    
    local inputPadding = Instance.new("UIPadding")
    inputPadding.PaddingLeft = UDim.new(0, 10)
    inputPadding.Parent = inputBox
    
    local createBtn = Instance.new("TextButton")
    createBtn.Size = UDim2.new(0, 100, 0, 30)
    createBtn.Position = UDim2.new(1, -100, 0, 0)
    createBtn.BackgroundColor3 = Color3.fromRGB(67, 110, 251)
    createBtn.BorderSizePixel = 0
    createBtn.Text = "ðŸ’¾ Save"
    createBtn.Font = Enum.Font.GothamBold
    createBtn.TextSize = 12
    createBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    createBtn.AutoButtonColor = false
    createBtn.Parent = inputFrame
    
    local createCorner = Instance.new("UICorner")
    createCorner.CornerRadius = UDim.new(0, 6)
    createCorner.Parent = createBtn
    
    createBtn.MouseButton1Click:Connect(function()
        local name = inputBox.Text
        if name ~= "" and name ~= "_autosave" then
            saveCurrentConfig(name)
            inputBox.Text = ""
        end
    end)
    
    createBtn.MouseEnter:Connect(function()
        createBtn.BackgroundColor3 = Color3.fromRGB(87, 130, 255)
    end)
    
    createBtn.MouseLeave:Connect(function()
        createBtn.BackgroundColor3 = Color3.fromRGB(67, 110, 251)
    end)
    
    currentY = currentY + 50
    
    local listContainer = Instance.new("ScrollingFrame")
    listContainer.Size = UDim2.new(1, 0, 0, 200)
    listContainer.Position = UDim2.new(0, 0, 0, currentY)
    listContainer.BackgroundColor3 = Color3.fromRGB(8, 10, 13)
    listContainer.BorderSizePixel = 1
    listContainer.BorderColor3 = Color3.fromRGB(28, 31, 38)
    listContainer.ScrollBarThickness = 4
    listContainer.ScrollBarImageColor3 = Color3.fromRGB(67, 110, 251)
    listContainer.CanvasSize = UDim2.new(0, 0, 0, 0)
    listContainer.Parent = Content
    
    local listCorner = Instance.new("UICorner")
    listCorner.CornerRadius = UDim.new(0, 8)
    listCorner.Parent = listContainer
    
    local listPadding = Instance.new("UIPadding")
    listPadding.PaddingTop = UDim.new(0, 8)
    listPadding.PaddingLeft = UDim.new(0, 8)
    listPadding.PaddingRight = UDim.new(0, 8)
    listPadding.PaddingBottom = UDim.new(0, 8)
    listPadding.Parent = listContainer
    
    local listLayout = Instance.new("UIListLayout")
    listLayout.SortOrder = Enum.SortOrder.LayoutOrder
    listLayout.Padding = UDim.new(0, 4)
    listLayout.Parent = listContainer
    
    configListFrame = listContainer
    
    listLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
        listContainer.CanvasSize = UDim2.new(0, 0, 0, listLayout.AbsoluteContentSize.Y + 16)
    end)
    
    currentY = currentY + 215
    
    local btnFrame = Instance.new("Frame")
    btnFrame.Size = UDim2.new(1, 0, 0, 35)
    btnFrame.Position = UDim2.new(0, 0, 0, currentY)
    btnFrame.BackgroundTransparency = 1
    btnFrame.Parent = Content
    
    local loadBtn = Instance.new("TextButton")
    loadBtn.Size = UDim2.new(0.48, 0, 0, 30)
    loadBtn.BackgroundColor3 = Color3.fromRGB(28, 31, 38)
    loadBtn.BorderSizePixel = 1
    loadBtn.BorderColor3 = Color3.fromRGB(40, 45, 55)
    loadBtn.Text = "Load Selected"
    loadBtn.Font = Enum.Font.Gotham
    loadBtn.TextSize = 12
    loadBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    loadBtn.AutoButtonColor = false
    loadBtn.Parent = btnFrame
    
    local loadCorner = Instance.new("UICorner")
    loadCorner.CornerRadius = UDim.new(0, 6)
    loadCorner.Parent = loadBtn
    
    loadBtn.MouseButton1Click:Connect(function()
        if selectedConfig then
            loadConfig(selectedConfig)
        end
    end)
    
    loadBtn.MouseEnter:Connect(function()
        loadBtn.BackgroundColor3 = Color3.fromRGB(38, 41, 48)
    end)
    
    loadBtn.MouseLeave:Connect(function()
        loadBtn.BackgroundColor3 = Color3.fromRGB(28, 31, 38)
    end)
    
    local deleteBtn = Instance.new("TextButton")
    deleteBtn.Size = UDim2.new(0.48, 0, 0, 30)
    deleteBtn.Position = UDim2.new(0.52, 0, 0, 0)
    deleteBtn.BackgroundColor3 = Color3.fromRGB(28, 31, 38)
    deleteBtn.BorderSizePixel = 1
    deleteBtn.BorderColor3 = Color3.fromRGB(40, 45, 55)
    deleteBtn.Text = "Delete"
    deleteBtn.Font = Enum.Font.Gotham
    deleteBtn.TextSize = 12
    deleteBtn.TextColor3 = Color3.fromRGB(255, 77, 77)
    deleteBtn.AutoButtonColor = false
    deleteBtn.Parent = btnFrame
    
    local deleteCorner = Instance.new("UICorner")
    deleteCorner.CornerRadius = UDim.new(0, 6)
    deleteCorner.Parent = deleteBtn
    
    deleteBtn.MouseButton1Click:Connect(function()
        if selectedConfig then
            ConfigSystem:Delete(selectedConfig)
            selectedConfig = nil
            refreshConfigList()
        end
    end)
    
    deleteBtn.MouseEnter:Connect(function()
        deleteBtn.BackgroundColor3 = Color3.fromRGB(38, 41, 48)
    end)
    
    deleteBtn.MouseLeave:Connect(function()
        deleteBtn.BackgroundColor3 = Color3.fromRGB(28, 31, 38)
    end)
    
    currentY = currentY + 35
    updateContentSize()
    
    refreshConfigList()
end

-- [[ KEYBIND TAB ]]
local function showKeybindTab()
    clearContent()
    
    createSection(Content, "Keybind Settings")
    
    local infoFrame = Instance.new("Frame")
    infoFrame.Size = UDim2.new(1, 0, 0, 40)
    infoFrame.Position = UDim2.new(0, 0, 0, currentY)
    infoFrame.BackgroundTransparency = 1
    infoFrame.Parent = Content
    
    local infoLabel = Instance.new("TextLabel")
    infoLabel.Size = UDim2.new(1, 0, 1, 0)
    infoLabel.BackgroundTransparency = 1
    infoLabel.Text = ""
    infoLabel.Font = Enum.Font.Gotham
    infoLabel.TextSize = 11
    infoLabel.TextColor3 = Color3.fromRGB(67, 110, 251)
    infoLabel.TextXAlignment = Enum.TextXAlignment.Left
    infoLabel.TextYAlignment = Enum.TextYAlignment.Top
    infoLabel.TextWrapped = true
    infoLabel.Parent = infoFrame
    
    currentY = currentY + 50
    
    createSection(Content, "Combat")
    createKeybind(Content, "Aimbot Toggle", "aimbotKey")
    
    currentY = currentY + 20
    createSection(Content, "Movement")
    createKeybind(Content, "Speed Toggle", "speedKey")
    createKeybind(Content, "Fly Toggle", "flyKey")
    
    currentY = currentY + 20
    createSection(Content, "Interface")
    createKeybind(Content, "UI Toggle", "uiKey")
end

-- [[ TABS ]]
local function showAimbotTab()
    clearContent()
    
    createSection(Content, "Main Settings")
    createToggle(Content, "Enable Aimbot", "aimbotEnabled")
    createToggle(Content, "Team Check", "teamCheck")
    createToggle(Content, "Prediction", "prediction")
    createToggle(Content, "Sticky Aim", "stickyAim")
    createToggle(Content, "FOV Circle", "fovCircle")
    
    currentY = currentY + 20
    createSection(Content, "Advanced")
    createSlider(Content, "FOV Size", "fovSize", 0, 500)
    createSlider(Content, "Smoothness", "smoothness", 1, 20)
    
    -- Info text
    local infoFrame = Instance.new("Frame")
    infoFrame.Size = UDim2.new(1, 0, 0, 60)
    infoFrame.Position = UDim2.new(0, 0, 0, currentY)
    infoFrame.BackgroundTransparency = 1
    infoFrame.Parent = Content
    
    local infoLabel = Instance.new("TextLabel")
    infoLabel.Size = UDim2.new(1, 0, 1, 0)
    infoLabel.BackgroundTransparency = 1
    infoLabel.Text = ""
    infoLabel.Font = Enum.Font.Gotham
    infoLabel.TextSize = 10
    infoLabel.TextColor3 = Color3.fromRGB(125, 133, 144)
    infoLabel.TextXAlignment = Enum.TextXAlignment.Left
    infoLabel.TextYAlignment = Enum.TextYAlignment.Top
    infoLabel.TextWrapped = true
    infoLabel.Parent = infoFrame
    
    currentY = currentY + 60
    updateContentSize()
end

local function showESPTab()
    clearContent()
    
    createSection(Content, "ESP Options")
    createToggle(Content, "Box ESP", "boxESP", refreshESP)
    createToggle(Content, "Box Fill", "boxFill", refreshESP)
    createToggle(Content, "Skeleton", "skeleton", refreshESP)
    createToggle(Content, "Name ESP", "nameESP", refreshESP)
    createToggle(Content, "Distance", "distanceESP", refreshESP)
    createToggle(Content, "Health Bar", "healthESP", refreshESP)
    createToggle(Content, "Tracers", "tracers", refreshESP)
    
    currentY = currentY + 20
    createSection(Content, "Customization")
    createSlider(Content, "Thickness", "espThickness", 1, 10, refreshESP)
end

local function showVisualsTab()
    clearContent()
    
    createSection(Content, "Environment")
    createToggle(Content, "Remove Fog", "removeFog", function(v)
        if v then
            Lighting.FogEnd = 100000
        else
            Lighting.FogEnd = originalLighting.FogEnd
        end
    end)
    createToggle(Content, "Fullbright", "fullbright", function(v)
        if v then
            Lighting.Brightness = 2
            Lighting.ClockTime = 14
        else
            Lighting.Brightness = originalLighting.Brightness
            Lighting.ClockTime = originalLighting.ClockTime
        end
    end)
    
    currentY = currentY + 20
    createSection(Content, "Skybox")
    createToggle(Content, "Custom Skybox", "skyboxEnabled", function(v)
        if v then
            applySkybox(state.skyboxType)
        else
            restoreSkybox()
        end
    end)
    createDropdown(Content, "Skybox Type", {"Default", "Night", "Space", "Purple Nebula", "Red Nebula", "Vaporwave"}, "skyboxType", function(v)
        state.skyboxType = v
        if state.skyboxEnabled then
            applySkybox(v)
        end
    end)
    
    currentY = currentY + 20
    createSection(Content, "UI Effects")
    createDropdown(Content, "Effects", {"none", "snow"}, "weatherEffect", function(v)
        if v == "none" then
            clearWeather()
        else
            weatherActive = true
        end
    end)
end

local function showMiscTab()
    clearContent()
    
    createSection(Content, "Movement")
    createToggle(Content, "Enable Speed", "speedEnabled", function(v)
        if player.Character and player.Character:FindFirstChildOfClass("Humanoid") then
            player.Character.Humanoid.WalkSpeed = v and state.speedValue or 16
        end
    end)
    createSlider(Content, "Speed Value", "speedValue", 16, 200, function(v)
        if state.speedEnabled and player.Character and player.Character:FindFirstChildOfClass("Humanoid") then
            player.Character.Humanoid.WalkSpeed = v
        end
    end)
    createToggle(Content, "Fly", "flyEnabled", function(v)
        toggleFly(v)
    end)
    createSlider(Content, "Fly Speed", "flySpeed", 50, 300)
    createToggle(Content, "Infinite Jump", "infiniteJump")
    
    currentY = currentY + 20
    createSection(Content, "Utilities")
    createToggle(Content, "Anti-AFK", "antiAFK", function(v)
        if v then
            local vu = game:GetService("VirtualUser")
            player.Idled:Connect(function()
                vu:Button2Down(Vector2.new(0,0), workspace.CurrentCamera.CFrame)
                task.wait(1)
                vu:Button2Up(Vector2.new(0,0), workspace.CurrentCamera.CFrame)
            end)
        end
    end)
end

-- [[ NAVIGATION ]]
local yPos = 125
createCategory("Combat", yPos)
yPos = yPos + 30
local aimbotBtn = createNavButton("Aimbot", "crosshair", yPos, showAimbotTab)
yPos = yPos + 40

yPos = yPos + 15
createCategory("Visuals", yPos)
yPos = yPos + 30
createNavButton("ESP", "eye", yPos, showESPTab)
yPos = yPos + 40
createNavButton("Environment", "cloud", yPos, showVisualsTab)
yPos = yPos + 40

yPos = yPos + 15
createCategory("Other", yPos)
yPos = yPos + 30
createNavButton("Misc", "gauge", yPos, showMiscTab)
yPos = yPos + 40
createNavButton("Keybinds", "keyboard", yPos, showKeybindTab)
yPos = yPos + 40
createNavButton("Configs", "save", yPos, showConfigTab)

showAimbotTab()
if aimbotBtn then
    local border = aimbotBtn:FindFirstChild("Frame")
    if border then border.Visible = true end
    aimbotBtn.BackgroundColor3 = Color3.fromRGB(67, 110, 251)
    aimbotBtn.BackgroundTransparency = 0.9
    local label = aimbotBtn:FindFirstChildOfClass("TextLabel")
    if label then label.TextColor3 = Color3.fromRGB(230, 237, 243) end
end

-- [[ FEATURES ]]
local fovCircle = Drawing.new("Circle")
fovCircle.Thickness = 2
fovCircle.NumSides = 50
fovCircle.Radius = state.fovSize
fovCircle.Color = Color3.fromRGB(67, 110, 251)
fovCircle.Visible = false
fovCircle.Filled = false

local function updateESP()
    for _, plr in pairs(game.Players:GetPlayers()) do
        if plr ~= player and espObjects[plr] and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
            local hrp = plr.Character.HumanoidRootPart
            local screenPos, onScreen = camera:WorldToViewportPoint(hrp.Position)
            
            if espObjects[plr].Box then
                espObjects[plr].Box.Visible = onScreen
                if onScreen then
                    local topPos = camera:WorldToViewportPoint((hrp.CFrame * CFrame.new(0, 3, 0)).Position)
                    local bottomPos = camera:WorldToViewportPoint((hrp.CFrame * CFrame.new(0, -3, 0)).Position)
                    local height = math.abs(topPos.Y - bottomPos.Y)
                    local width = height / 2
                    espObjects[plr].Box.Size = Vector2.new(width, height)
                    espObjects[plr].Box.Position = Vector2.new(screenPos.X - width/2, screenPos.Y - height/2)
                end
            end
            
            if espObjects[plr].Fill then
                espObjects[plr].Fill.Visible = onScreen
                if onScreen then
                    local topPos = camera:WorldToViewportPoint((hrp.CFrame * CFrame.new(0, 3, 0)).Position)
                    local bottomPos = camera:WorldToViewportPoint((hrp.CFrame * CFrame.new(0, -3, 0)).Position)
                    local height = math.abs(topPos.Y - bottomPos.Y)
                    local width = height / 2
                    espObjects[plr].Fill.Size = Vector2.new(width, height)
                    espObjects[plr].Fill.Position = Vector2.new(screenPos.X - width/2, screenPos.Y - height/2)
                end
            end
            
            if espObjects[plr].Name then
                espObjects[plr].Name.Visible = onScreen
                if onScreen then
                    local topPos = camera:WorldToViewportPoint((hrp.CFrame * CFrame.new(0, 4, 0)).Position)
                    espObjects[plr].Name.Position = Vector2.new(topPos.X, topPos.Y)
                end
            end
            
            if espObjects[plr].Distance then
                espObjects[plr].Distance.Visible = onScreen
                if onScreen and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                    local dist = math.floor((player.Character.HumanoidRootPart.Position - hrp.Position).Magnitude)
                    espObjects[plr].Distance.Text = dist .. "m"
                    local bottomPos = camera:WorldToViewportPoint((hrp.CFrame * CFrame.new(0, -3.5, 0)).Position)
                    espObjects[plr].Distance.Position = Vector2.new(bottomPos.X, bottomPos.Y)
                end
            end
            
            if espObjects[plr].Tracer then
                espObjects[plr].Tracer.Visible = onScreen
                if onScreen then
                    espObjects[plr].Tracer.From = Vector2.new(camera.ViewportSize.X/2, camera.ViewportSize.Y)
                    espObjects[plr].Tracer.To = Vector2.new(screenPos.X, screenPos.Y)
                end
            end
        end
    end
end

local function getClosestPlayer()
    local closest = nil
    local shortestDist = state.fovSize
    local mousePos = UserInputService:GetMouseLocation()
    
    for _, plr in pairs(game.Players:GetPlayers()) do
        if plr ~= player and plr.Character and plr.Character:FindFirstChild("Head") then
            if state.teamCheck and plr.Team == player.Team then continue end
            
            local head = plr.Character.Head
            local screenPos, onScreen = camera:WorldToViewportPoint(head.Position)
            
            if onScreen then
                local dist = (Vector2.new(screenPos.X, screenPos.Y) - mousePos).Magnitude
                if dist < shortestDist then
                    shortestDist = dist
                    closest = plr
                end
            end
        end
    end
    
    return closest
end

-- ERSÃ„TT HELA FLY SYSTEM SEKTIONEN MED DENNA KOD
-- Hitta raden som sÃ¤ger "-- [[ IMPROVED FLY SYSTEM ]]" och ersÃ¤tt allt dÃ¤rifrÃ¥n till "-- [[ MAIN LOOPS ]]"

-- [[ IMPROVED CFRAME FLY SYSTEM (SAFER) ]]
local flyConnection
local flyActive = false
local flySpeed = 50

function toggleFly(enabled)
    flyActive = enabled
    
    -- Disconnect old connection
    if flyConnection then
        flyConnection:Disconnect()
        flyConnection = nil
    end
    
    if enabled and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
        local char = player.Character
        local hrp = char.HumanoidRootPart
        local humanoid = char:FindFirstChildOfClass("Humanoid")
        
        if not humanoid then return end
        
        -- Disable normal gravity/physics
        hrp.Anchored = false
        
        flyConnection = RunService.Heartbeat:Connect(function(delta)
            if not flyActive or not player.Character or not char:FindFirstChild("HumanoidRootPart") then
                toggleFly(false)
                return
            end
            
            local hrp = char.HumanoidRootPart
            if not hrp then 
                toggleFly(false)
                return 
            end
            
            -- Calculate movement direction
            local velocity = Vector3.new(0, 0, 0)
            local speed = state.flySpeed
            local camCFrame = workspace.CurrentCamera.CFrame
            
            if UserInputService:IsKeyDown(Enum.KeyCode.W) then
                velocity = velocity + camCFrame.LookVector
            end
            if UserInputService:IsKeyDown(Enum.KeyCode.S) then
                velocity = velocity - camCFrame.LookVector
            end
            if UserInputService:IsKeyDown(Enum.KeyCode.A) then
                velocity = velocity - camCFrame.RightVector
            end
            if UserInputService:IsKeyDown(Enum.KeyCode.D) then
                velocity = velocity + camCFrame.RightVector
            end
            if UserInputService:IsKeyDown(Enum.KeyCode.Space) then
                velocity = velocity + Vector3.new(0, 1, 0)
            end
            if UserInputService:IsKeyDown(Enum.KeyCode.LeftShift) then
                velocity = velocity - Vector3.new(0, 1, 0)
            end
            
            -- Normalize and apply speed
            if velocity.Magnitude > 0 then
                velocity = velocity.Unit * speed * delta
            end
            
            -- CFRAME FLY - Safer method
            pcall(function()
                hrp.CFrame = hrp.CFrame + velocity
                hrp.Velocity = Vector3.new(0, 0, 0) -- Cancel any physics velocity
                hrp.RotVelocity = Vector3.new(0, 0, 0)
            end)
        end)
        
        print("âœˆï¸ CFrame Fly enabled! (Safer mode)")
    else
        if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            local hrp = player.Character.HumanoidRootPart
            hrp.Velocity = Vector3.new(0, 0, 0)
            hrp.Anchored = false
        end
        print("ðŸš« Fly disabled")
    end
end

-- [[ MAIN LOOPS ]]
RunService.RenderStepped:Connect(function()
    if state.fovCircle then
        local mousePos = UserInputService:GetMouseLocation()
        fovCircle.Position = mousePos
        fovCircle.Radius = state.fovSize
        fovCircle.Visible = true
    else
        fovCircle.Visible = false
    end
    
    -- Aimbot logic - active when enabled
    if state.aimbotEnabled then
        local target = getClosestPlayer()
        if target and target.Character and target.Character:FindFirstChild("Head") then
            local targetPos = target.Character.Head.Position
            
            if state.prediction and target.Character:FindFirstChild("HumanoidRootPart") then
                local targetVel = target.Character.HumanoidRootPart.AssemblyLinearVelocity
                targetPos = targetPos + (targetVel * 0.165)
            end
            
            local currentCFrame = camera.CFrame
            local targetCFrame = CFrame.new(currentCFrame.Position, targetPos)
            camera.CFrame = currentCFrame:Lerp(targetCFrame, 1 / state.smoothness)
        end
    end
    
    if state.boxESP or state.nameESP or state.distanceESP or state.tracers then
        updateESP()
    end
end)

-- Keybind listener
UserInputService.InputBegan:Connect(function(input, gpe)
    if gpe then return end
    
    -- Handle keybind listening (supports both keyboard and mouse)
    if listeningForKey then
        local inputName = getInputType(input)
        if inputName then
            state[listeningForKey.stateKey] = inputName
            listeningForKey.button.Text = getKeyName(inputName)
            listeningForKey.button.BackgroundColor3 = Color3.fromRGB(8, 10, 13)
            listeningForKey = nil
            ConfigSystem:SaveLast(state)
        end
        return
    end
    
    -- Check keybinds
    local inputName = getInputType(input)
    if not inputName then return end
    
    if inputName == state.aimbotKey then
        state.aimbotEnabled = not state.aimbotEnabled
        print(state.aimbotEnabled and "ðŸŽ¯ Aimbot ON" or "ðŸš« Aimbot OFF")
    elseif inputName == state.speedKey then
        state.speedEnabled = not state.speedEnabled
        if player.Character and player.Character:FindFirstChildOfClass("Humanoid") then
            player.Character.Humanoid.WalkSpeed = state.speedEnabled and state.speedValue or 16
        end
        print(state.speedEnabled and "âš¡ Speed ON" or "ðŸš« Speed OFF")
    elseif inputName == state.flyKey then
        state.flyEnabled = not state.flyEnabled
        toggleFly(state.flyEnabled)
    elseif inputName == state.uiKey then
        Window.Visible = not Window.Visible
        if Window.Visible then
            Window.BackgroundTransparency = 1
            Window.Size = UDim2.new(0, 0, 0, 0)
            
            TweenService:Create(Window, TweenInfo.new(0.4, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
                Size = UDim2.new(0, 850, 0, 580),
                BackgroundTransparency = 0
            }):Play()
            
            weatherActive = state.weatherEffect ~= "none"
        else
            clearWeather()
        end
    end
    
    if input.KeyCode == Enum.KeyCode.Space and state.infiniteJump then
        if player.Character and player.Character:FindFirstChildOfClass("Humanoid") then
            player.Character.Humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
        end
    end
end)

-- Player events
game.Players.PlayerAdded:Connect(function(plr)
    task.wait(1)
    if plr.Character then createESP(plr) end
    plr.CharacterAdded:Connect(function()
        task.wait(0.5)
        createESP(plr)
    end)
end)

game.Players.PlayerRemoving:Connect(function(plr)
    removeESP(plr)
end)

player.CharacterAdded:Connect(function(char)
    local humanoid = char:WaitForChild("Humanoid", 5)
    if not humanoid then return end
    
    if state.speedEnabled then
        humanoid.WalkSpeed = state.speedValue
    end
    
    if state.flyEnabled then
        toggleFly(false)
        state.flyEnabled = false
    end
    
    task.wait(1)
    refreshESP()
end)

-- Init ESP
for _, plr in pairs(game.Players:GetPlayers()) do
    if plr ~= player and plr.Character then
        createESP(plr)
    end
    plr.CharacterAdded:Connect(function()
        task.wait(0.5)
        createESP(plr)
    end)
end

-- Cleanup
local function cleanup()
    for _, plr in pairs(game.Players:GetPlayers()) do
        removeESP(plr)
    end
    if fovCircle then pcall(function() fovCircle:Remove() end) end
    if flyBodyGyro then pcall(function() flyBodyGyro:Destroy() end) end
    if flyConnection then flyConnection:Disconnect() end
    if ScreenGui then pcall(function() ScreenGui:Destroy() end) end
    clearWeather()
    restoreSkybox()
end
-- Lägg till efter cleanup() funktionen:

-- GLOBAL UNLOAD FUNKTION
_G.GorillaHookCleanup = function()
    print("Running full cleanup...")
    cleanup()
    
    -- Stäng av fly ordentligt
    if flyActive then
        flyActive = false
        toggleFly(false)
    end
    
    -- Stäng av alla features
    state.aimbotEnabled = false
    state.speedEnabled = false
    state.flyEnabled = false
    
    print("Cleanup complete!")
end

game:GetService("CoreGui").DescendantRemoving:Connect(function(obj)
    if obj == ScreenGui then
        cleanup()
    end
end)
-- Remove Lifetime Badge
spawn(function()
    wait(1)
    pcall(function()
        game:GetService("CoreGui").GorillaHookUI.Window.LifetimeBadge:Destroy()
    end)
end)
-- Initial animation
task.wait(0.1)
weatherActive = state.weatherEffect ~= "none"

TweenService:Create(Window, TweenInfo.new(0.5, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
    Size = UDim2.new(0, 850, 0, 580),
    BackgroundTransparency = 0
}):Play()

print("â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—")
print("â•‘      âœ¨ GORILLAHOOK PRIVATE v1.1 âœ¨     â•‘")
print("â•‘      Enhanced Universal Executor      â•‘")
print("â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•")
print("")
print("âœ… Features:")
print("  ðŸŽ¯ Advanced Aimbot")
print("     - Toggle ON/OFF with one keybind")
print("     - Always active when enabled")
print("     - Supports ALL mouse buttons + keyboard")
print("  ðŸ‘ï¸ Full ESP System")
print("  âœˆï¸ Improved Smooth Fly")
print("  ðŸŒŒ Custom Skybox System")
print("  ðŸŒ¨ï¸ UI Effects (Snow)")
print("  ðŸ’¾ Persistent Config System")
print("  âŒ¨ï¸ Customizable Keybinds")
print("  ðŸŽ¨ Modern UI with Logo")
print("  âš¡ High-Performance")
print("")
print("ðŸ”Œ Default Keybinds:")
print("  " .. getKeyName(state.aimbotKey) .. ": Toggle Aimbot (Always active when ON!)")
print("  " .. getKeyName(state.speedKey) .. ": Toggle Speed")
print("  " .. getKeyName(state.flyKey) .. ": Toggle Fly (WASD + Space/Shift)")
print("  " .. getKeyName(state.uiKey) .. ": Toggle UI")
print("")
print("ðŸ’¾ Auto-save: Settings persist across sessions!")
print("ðŸŒ Universal - Works on ALL Roblox games!")
print("")
if lastConfig then
    print("ðŸ“„ Last session config loaded automatically")
end

-- Apply skybox if enabled
if state.skyboxEnabled then
    applySkybox(state.skyboxType)
end

-- [[ STICKY AIM FIX - LÄGG TILL DETTA LÄNGST NER ]]
local stickyTarget = nil
local stickyLocked = false

-- Modifiera aimbot-logiken
local oldGetClosest = getClosestPlayer
function getClosestPlayer()
    -- Om sticky aim är PÅ och vi har en target - FORTSÄTT SIKTA PÅ DEN!
    if state.stickyAim and stickyLocked and stickyTarget then
        if stickyTarget.Character and stickyTarget.Character:FindFirstChild("Head") then
            return stickyTarget  -- RETURNERA SAMMA PERSON
        else
            -- Target dog - släpp låset
            stickyLocked = false
            stickyTarget = nil
        end
    end
    
    -- Annars hitta ny target
    local newTarget = oldGetClosest()
    
    -- Om sticky aim är PÅ och vi hittade någon - LÅS!
    if state.stickyAim and newTarget and state.aimbotEnabled then
        stickyTarget = newTarget
        stickyLocked = true
        print("🔒 LOCKED: " .. newTarget.Name)
    end
    
    return newTarget
end

-- Släpp låset när aimbot stängs av
local oldInputBegan = UserInputService.InputBegan:Connect(function() end)
UserInputService.InputBegan:Connect(function(input, gpe)
    if gpe then return end
    
    local inputName = getInputType(input)
    if inputName == state.aimbotKey then
        -- När aimbot stängs av - släpp sticky lock
        if not state.aimbotEnabled then
            stickyLocked = false
            stickyTarget = nil
            print("🔓 Sticky lock released")
        end
    end
end)

print("✅ STICKY AIM FIX LOADED!")
print("💡 Slå PÅ 'Sticky Aim' i Aimbot-tabben")
print("🎯 När du siktar på någon = LÅST tills du släpper aimbot-knappen!")

-- HIT SOUND + CROSSHAIR + WALL CHECK - FIXED VERSION

print("Loading Features...")

-- CROSSHAIR SYSTEM
local CrosshairSystem = {
    enabled = false,
    spinning = false,
    rainbow = false,
    size = 10,
    thickness = 2,
    rotation = 0,
    style = "Cross"
}

local crosshairLines = {}

local function createCrosshair()
    for i = 1, 4 do
        local line = Drawing.new("Line")
        line.Thickness = CrosshairSystem.thickness
        line.Color = Color3.fromRGB(255, 255, 255)
        line.Transparency = 1
        line.Visible = false
        table.insert(crosshairLines, line)
    end
end

local function updateCrosshair()
    if not CrosshairSystem.enabled then
        for _, line in pairs(crosshairLines) do
            line.Visible = false
        end
        return
    end
    
    local center = Vector2.new(camera.ViewportSize.X / 2, camera.ViewportSize.Y / 2)
    local size = CrosshairSystem.size
    
    if CrosshairSystem.rainbow then
        local hue = tick() % 5 / 5
        local color = Color3.fromHSV(hue, 1, 1)
        for _, line in pairs(crosshairLines) do
            line.Color = color
        end
    end
    
    if CrosshairSystem.spinning then
        CrosshairSystem.rotation = (CrosshairSystem.rotation + 3) % 360
    end
    
    local rad = math.rad(CrosshairSystem.rotation)
    
    if CrosshairSystem.style == "Cross" then
        crosshairLines[1].From = Vector2.new(center.X + math.sin(rad) * size, center.Y - math.cos(rad) * size)
        crosshairLines[1].To = Vector2.new(center.X + math.sin(rad) * (size * 2), center.Y - math.cos(rad) * (size * 2))
        crosshairLines[1].Visible = true
        
        crosshairLines[2].From = Vector2.new(center.X - math.sin(rad) * size, center.Y + math.cos(rad) * size)
        crosshairLines[2].To = Vector2.new(center.X - math.sin(rad) * (size * 2), center.Y + math.cos(rad) * (size * 2))
        crosshairLines[2].Visible = true
        
        crosshairLines[3].From = Vector2.new(center.X - math.cos(rad) * size, center.Y - math.sin(rad) * size)
        crosshairLines[3].To = Vector2.new(center.X - math.cos(rad) * (size * 2), center.Y - math.sin(rad) * (size * 2))
        crosshairLines[3].Visible = true
        
        crosshairLines[4].From = Vector2.new(center.X + math.cos(rad) * size, center.Y + math.sin(rad) * size)
        crosshairLines[4].To = Vector2.new(center.X + math.cos(rad) * (size * 2), center.Y + math.sin(rad) * (size * 2))
        crosshairLines[4].Visible = true
        
    elseif CrosshairSystem.style == "Swastika" then
        local offset = size * 0.7
        local length = size * 2
        
        crosshairLines[1].From = Vector2.new(center.X + math.sin(rad) * offset, center.Y - math.cos(rad) * offset)
        crosshairLines[1].To = Vector2.new(center.X + math.sin(rad) * length + math.cos(rad) * length, center.Y - math.cos(rad) * length + math.sin(rad) * length)
        crosshairLines[1].Visible = true
        
        crosshairLines[2].From = Vector2.new(center.X - math.sin(rad) * offset, center.Y + math.cos(rad) * offset)
        crosshairLines[2].To = Vector2.new(center.X - math.sin(rad) * length - math.cos(rad) * length, center.Y + math.cos(rad) * length - math.sin(rad) * length)
        crosshairLines[2].Visible = true
        
        crosshairLines[3].From = Vector2.new(center.X - math.cos(rad) * offset, center.Y - math.sin(rad) * offset)
        crosshairLines[3].To = Vector2.new(center.X - math.cos(rad) * length + math.sin(rad) * length, center.Y - math.sin(rad) * length - math.cos(rad) * length)
        crosshairLines[3].Visible = true
        
        crosshairLines[4].From = Vector2.new(center.X + math.cos(rad) * offset, center.Y + math.sin(rad) * offset)
        crosshairLines[4].To = Vector2.new(center.X + math.cos(rad) * length - math.sin(rad) * length, center.Y + math.sin(rad) * length + math.cos(rad) * length)
        crosshairLines[4].Visible = true
    end
end

createCrosshair()

-- HIT SOUND SYSTEM - FIXAD MED RÄTT LJUDFILER
local HitSoundSystem = {
    enabled = false,
    soundType = "Gamesense",
    sounds = {
        Gamesense = "rbxassetid://4753603610",
        Neverlose = "rbxassetid://8679627751",
        Fatality = "rbxassetid://6607339542"
    },
    lastHealth = {},
    lastShotTime = 0,
    healthCheckCooldown = {}  -- NYTT: För att undvika spam
}

local hitSounds = {}
for name, id in pairs(HitSoundSystem.sounds) do
    local sound = Instance.new("Sound")
    sound.SoundId = id
    sound.Volume = 1
    sound.Parent = game:GetService("SoundService")
    hitSounds[name] = sound
    game:GetService("ContentProvider"):PreloadAsync({sound})
end

local function playHitSound()
    if HitSoundSystem.enabled then
        local sound = hitSounds[HitSoundSystem.soundType]
        if sound then
            local newSound = sound:Clone()
            newSound.Parent = game:GetService("SoundService")
            newSound:Play()
            game:GetService("Debris"):AddItem(newSound, 2)
        end
    end
end

local function detectYourShot()
    if not player.Character then return false end
    
    local tool = player.Character:FindFirstChildOfClass("Tool")
    if tool then
        local hasRemote = tool:FindFirstChildOfClass("RemoteEvent") or tool:FindFirstChild("Fire")
        local hasHandle = tool:FindFirstChild("Handle")
        
        if hasRemote or hasHandle then
            return true
        end
    end
    
    return false
end

-- FÖRBÄTTRAD HEALTH MONITOR
local function monitorHealth()
    if not HitSoundSystem.enabled then return end
    
    local currentTime = tick()
    local justShot = currentTime - HitSoundSystem.lastShotTime < 0.8  -- ÖKAT från 0.5 till 0.8
    
    if not justShot then return end
    
    for _, plr in pairs(game.Players:GetPlayers()) do
        if plr ~= player and plr.Character then
            local humanoid = plr.Character:FindFirstChildOfClass("Humanoid")
            if humanoid and humanoid.Health > 0 then
                
                -- Initiera health tracking
                if not HitSoundSystem.lastHealth[plr] then
                    HitSoundSystem.lastHealth[plr] = humanoid.Health
                end
                
                -- Kolla cooldown för att undvika spam
                local cooldown = HitSoundSystem.healthCheckCooldown[plr] or 0
                if currentTime - cooldown < 0.1 then
                    continue
                end
                
                -- Kolla health drop (mer känslig)
                local healthDrop = HitSoundSystem.lastHealth[plr] - humanoid.Health
                if healthDrop > 0.1 then
                    playHitSound()
                    HitSoundSystem.healthCheckCooldown[plr] = currentTime
                    print("Hit detected on " .. plr.Name .. " (Damage: " .. math.floor(healthDrop) .. ")")
                end
                
                HitSoundSystem.lastHealth[plr] = humanoid.Health
            end
        end
    end
end

UserInputService.InputBegan:Connect(function(input, gpe)
    if gpe then return end
    
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        if detectYourShot() then
            HitSoundSystem.lastShotTime = tick()
        end
    end
end)

game.Players.PlayerRemoving:Connect(function(plr)
    HitSoundSystem.lastHealth[plr] = nil
    HitSoundSystem.healthCheckCooldown[plr] = nil
end)

-- WALL CHECK SYSTEM
local WallCheckSystem = {
    enabled = false
}

local function hasLineOfSight(fromPos, toPos)
    if not WallCheckSystem.enabled then return true end
    
    local direction = (toPos - fromPos)
    local distance = direction.Magnitude
    
    local raycastParams = RaycastParams.new()
    raycastParams.FilterType = Enum.RaycastFilterType.Blacklist
    
    local ignoreList = {player.Character}
    for _, plr in pairs(game.Players:GetPlayers()) do
        if plr.Character then
            table.insert(ignoreList, plr.Character)
        end
    end
    raycastParams.FilterDescendantsInstances = ignoreList
    raycastParams.IgnoreWater = true
    
    local result = workspace:Raycast(fromPos, direction.Unit * (distance - 1), raycastParams)
    
    return result == nil
end

local originalGetClosestPlayer = getClosestPlayer

getClosestPlayer = function()
    local target = originalGetClosestPlayer()
    
    if WallCheckSystem.enabled and target and target.Character and target.Character:FindFirstChild("Head") then
        if player.Character and player.Character:FindFirstChild("Head") then
            local myPos = player.Character.Head.Position
            local targetPos = target.Character.Head.Position
            
            if not hasLineOfSight(myPos, targetPos) then
                return nil
            end
        end
    end
    
    return target
end

-- CREATE TAB
local function showExtraTab()
    clearContent()
    
    createSection(Content, "Crosshair")
    
    createToggle(Content, "Enable Crosshair", "enableCrosshair", function(v)
        CrosshairSystem.enabled = v
        if not v then
            CrosshairSystem.rainbow = false
            CrosshairSystem.spinning = false
        end
    end)
    
    createToggle(Content, "Rainbow Colors", "rainbowCrosshair", function(v)
        CrosshairSystem.rainbow = v
        if v then CrosshairSystem.enabled = true end
    end)
    
    createToggle(Content, "Spinning", "spinningCrosshair", function(v)
        CrosshairSystem.spinning = v
        if v then CrosshairSystem.enabled = true end
    end)
    
    currentY = currentY + 15
    
    createDropdown(Content, "Crosshair Style", {"Cross", "Swastika"}, "crosshairStyle", function(v)
        CrosshairSystem.style = v
    end)
    
    currentY = currentY + 20
    
    createSlider(Content, "Crosshair Size", "crosshairSize", 5, 30, function(v)
        CrosshairSystem.size = v
    end)
    
    currentY = currentY + 35
    createSection(Content, "Hit Sound")
    
    createToggle(Content, "Enable Hit Sound", "hitSound", function(v)
        HitSoundSystem.enabled = v
    end)
    
    currentY = currentY + 10
    
    createSlider(Content, "Hit Sound Volume", "hitVolume", 0, 100, function(v)
        for _, sound in pairs(hitSounds) do
            sound.Volume = v / 100
        end
    end)
    
    currentY = currentY + 20
    
    createDropdown(Content, "Sound Type", {"Gamesense", "Neverlose", "Fatality"}, "hitSoundType", function(v)
        HitSoundSystem.soundType = v
        print("Hit sound changed to: " .. v)
    end)
    
    currentY = currentY + 50
    createSection(Content, "Aimbot Settings")
    
    createToggle(Content, "Wall Check", "wallCheck", function(v)
        WallCheckSystem.enabled = v
    end)
    
    updateContentSize()
end

state.enableCrosshair = false
state.crosshairStyle = "Cross"
state.rainbowCrosshair = false
state.spinningCrosshair = false
state.crosshairSize = 10
state.hitSound = false
state.hitSoundType = "Gamesense"
state.hitVolume = 100
state.wallCheck = false

-- ADD TAB
local lastYPos = 125
for _, child in pairs(Sidebar:GetChildren()) do
    if child:IsA("TextButton") then
        lastYPos = math.max(lastYPos, child.Position.Y.Offset + 40)
    elseif child:IsA("TextLabel") and child.Text:upper() == child.Text then
        lastYPos = math.max(lastYPos, child.Position.Y.Offset + 50)
    end
end

createCategory("EXTRA", lastYPos)
createNavButton("Extra", "star", lastYPos + 30, showExtraTab)

-- MAIN LOOP
RunService.RenderStepped:Connect(function()
    updateCrosshair()
    monitorHealth()
end)

-- INIT
print("")
print("Features Loaded!")
print("Hit Sounds:")
print("   - Gamesense: rbxassetid://4753603610")
print("   - Neverlose: rbxassetid://8679627751")
print("   - Fatality: rbxassetid://6607339542")
print("")

task.wait(0.5)
if lastConfig then
    if lastConfig.enableCrosshair then CrosshairSystem.enabled = true end
    if lastConfig.crosshairStyle then CrosshairSystem.style = lastConfig.crosshairStyle end
    if lastConfig.rainbowCrosshair then CrosshairSystem.rainbow = true end
    if lastConfig.spinningCrosshair then CrosshairSystem.spinning = true end
    if lastConfig.crosshairSize then CrosshairSystem.size = lastConfig.crosshairSize end
    if lastConfig.hitSound then HitSoundSystem.enabled = true end
    if lastConfig.hitSoundType then HitSoundSystem.soundType = lastConfig.hitSoundType end
    if lastConfig.hitVolume then 
        for _, sound in pairs(hitSounds) do
            sound.Volume = lastConfig.hitVolume / 100
        end
    end
    if lastConfig.wallCheck ~= nil then WallCheckSystem.enabled = lastConfig.wallCheck end
end
